// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.9;

import "forge-std/Test.sol";
import {NFTMarketplace} from "./challenge/NFTMarketplace.sol";
import {Create2} from "src/utils/Create2.sol";
import {Exploit} from "./Exploit.sol";

contract ExploitTest is Test {
    NFTMarketplace nftMarketplace;
    address playerAddress = makeAddr("player");

    function setUp() public {
        nftMarketplace = new NFTMarketplace();
        vm.startPrank(playerAddress, playerAddress);
    }

    function testCreate2GetAddress() public {
        address nmTokenAddress = Create2.getAddress(
            address(nftMarketplace),
            keccak256("NMToken"),
            nftMarketplace.getTokenVersion(),
            abi.encode("NM Token", "NMToken")
        );
        address rareNFTAddress = Create2.getAddress(
            address(nftMarketplace),
            keccak256("rareNFT"),
            nftMarketplace.getNFTVersion(),
            abi.encode("Rare NFT", "rareNFT")
        );
        nftMarketplace.initialize();
        assertEq(address(nftMarketplace.nmToken()), nmTokenAddress);
        assertEq(address(nftMarketplace.rareNFT()), rareNFTAddress);
    }

    function testExploit() public {
        Exploit exploit = new Exploit();
        exploit.execute(address(nftMarketplace));
    }
}
